<div class="media-selector">
  <p-tabs [(value)]="selectedTab">
    <p-tablist>
      <p-tab value="media">
        <span class="pi pi-images tab-icon"></span>
        <span>Image ou vidéo</span>
      </p-tab>

      <p-tab value="youtube">
        <span class="pi pi-youtube tab-icon"></span>
        <span>Lien YouTube</span>
      </p-tab>
    </p-tablist>

    <p-tabpanels>
      <!-- Onglet 1 : Upload médias -->
      <p-tabpanel value="media">
        <div class="tab-panel tab-panel--media">
          <p class="hint">
            Tu peux déposer une ou plusieurs images ou vidéos.
            Seuls les fichiers avec un type MIME
            <code>image/*</code> ou <code>video/*</code> sont acceptés.
          </p>

          <!-- Zone d’upload -->
          <label [class.upload-zone--disabled]="disabled" class="upload-zone">
            <input
              (change)="onFilesSelected($event)"
              [disabled]="disabled"
              [multiple]="multiple"
              accept="image/*,video/*"
              type="file"
            />
            <div class="upload-zone__content">
              <span class="pi pi-upload upload-zone__icon"></span>
              <div class="upload-zone__text">
                <strong>Clique pour choisir des fichiers</strong>
                <span>ou glisse-les ici</span>
              </div>
            </div>
          </label>
        </div>
      </p-tabpanel>

      <!-- Onglet 2 : Lien YouTube / externe -->
      <p-tabpanel value="youtube">
        <div class="tab-panel tab-panel--youtube">
          <label for="youtube-url">Lien YouTube ou URL externe</label>
          <input
            (ngModelChange)="youtubeUrl.set($event)"
            [disabled]="disabled"
            [ngModelOptions]="{ standalone: true }"
            [ngModel]="youtubeUrl()"
            [placeholder]="placeholderYoutube"
            id="youtube-url"
            pInputText
            type="url"
          />

          <p class="hint">
            Colle un lien complet YouTube ou une URL courte.
            Le composant l’ajoutera comme média de type
            <code>external</code>.
          </p>

          <p-button
            (click)="addYoutubeLink()"
            [disabled]="disabled || !youtubeUrl().trim()"
            class="youtube-add-btn"
            icon="pi pi-plus"
            label="Ajouter ce lien"
            type="button"
          ></p-button>
        </div>
      </p-tabpanel>
    </p-tabpanels>
  </p-tabs>
  @if (items.length) {
    <div class="media-list">
      @for (m of items; track m; let i = $index) {
        <div class="media-list__item">
          <div class="media-list__thumb">
            @switch (m.kind) {

              @case ('image') {
                @if (mediaSrc(m); as src) {
                  <a
                    [href]="src"
                    target="_blank"
                    rel="noopener"
                    class="media-thumb-link">
                    <!-- href="{{ getMediaLabel(m) }}">-->
                    <img
                      [src]="src"
                      alt="Aperçu image"
                      class="media-thumb-image"
                    />
                  </a>
                } @else {
                  <span class="pi pi-image media-list__icon"></span>
                }
              }
              @case ('video') {

                @if (mediaSrc(m); as src) {
                  <a
                    [href]="src"
                    target="_blank"
                    rel="noopener"
                    class="media-thumb-link"
                  >
                    <video
                      [src]="src"
                      class="media-thumb-video"
                      muted
                    ></video>
                  </a>
                } @else {
                  <span class="pi pi-video media-list__icon"></span>
                }

              }
              @case ('external') {

                @if (mediaSrc(m); as src) {
                  <a
                    [href]="src"
                    target="_blank"
                    rel="noopener"
                    class="media-thumb-link"
                  >
                    <span class="pi pi-youtube media-list__icon"></span>
                  </a>
                } @else {
                  <span class="pi pi-link media-list__icon"></span>
                }

              }

            }
          </div>

          <div class="media-list__info">
            <div class="media-list__name">
              @if (mediaSrc(m); as src) {
                <a
                  [href]="src"
                  target="_blank"
                  rel="noopener"
                  class="media-thumb-link"
                >
                  {{ getMediaLabel(m) }}
                </a>
              }
            </div>
            @if (getMediaTag(m); as tag) {
              <div class="media-list__meta">
                <i class="pi {{ tag.icon }} media-type-icon"></i>
                <p-tag [value]="tag.label" [severity]="tag.severity"></p-tag>
              </div>
            }
          </div>

          <p-button
            type="button"
            class="media-list__remove"
            icon="pi pi-times"
            severity="danger"
            text
            rounded
            (click)="removeMedia(i)"
          ></p-button>
        </div>
      }
    </div>
  } @else {
    <p class="media-list--empty">
      Aucun média sélectionné pour l’instant.
    </p>
  }
</div>
