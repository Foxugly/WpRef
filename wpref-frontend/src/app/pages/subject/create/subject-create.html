<p-card header="Créer un domain">
  <div class="card__content">
    <div class="field">
      <label>Domaine</label>
      <p-select
        (onChange)="onDomainChange($event.value)"
        [disabled]="loading() || translating()"
        [filter]="true"
        [ngModel]="selectedDomainId()"
        [options]="staffDomains()"
        [showClear]="true"
        optionLabel="name"
        optionValue="id"
        placeholder="Choisir un domaine"
      ></p-select>
    </div>
  </div>

  <!-- Translations card -->
  @if (selectedDomainId() && langs().length > 0) {
    <div class="card">
      <div class="card__content">
        <p-tabs>
          <p-tablist>
            @for (lang of langs(); track lang) {
              <p-tab (click)="onTabChange(lang)" [value]="lang">
                {{ lang.toUpperCase() }}
              </p-tab>
            }
          </p-tablist>

          <p-tabpanels>
            @for (lang of langs(); track lang) {
              <p-tabpanel [value]="lang">
                @if (formsByLang()[lang]; as fg) {
                  <div class="tab-toolbar">
                    <p-button
                      (click)="translateFromActiveTab()"
                      [disabled]="translating()"
                      [loading]="translating()"
                      icon="pi pi-language"
                      label="Traduire vers les autres langues"
                      type="button">
                    </p-button>
                  </div>
                  <div class="lang-grid">
                    <div class="field">
                      <label>Name</label>
                      <input
                        [disabled]="loading() || translating()"
                        [formControl]="fg.controls.name"
                        pInputText
                        placeholder="Ex: Math"
                      />
                      @if (fg.controls.name.invalid && fg.controls.name.touched) {
                        <small class="error">Champ requis</small>
                      }
                    </div>

                    <div class="field field--full">
                      <label>Description</label>
                      <p-editor
                        [formControl]="fg.controls.description"
                        [style]="{ height: '240px' }"
                      ></p-editor>
                    </div>
                  </div>
                }
              </p-tabpanel>
            }
          </p-tabpanels>
        </p-tabs>

        @if (translating()) {
          <div class="inline-status">
            <i class="pi pi-spin pi-spinner"></i>
            <span>Traduction en cours…</span>
          </div>
        }
      </div>
    </div>
  } @else if (selectedDomainId() && langs().length === 0) {
    <div class="alert alert--info">Ce domaine n’a pas de langues configurées.</div>
  }

  @if (loading()) {
    <div class="inline-status">
      <i class="pi pi-spin pi-spinner"></i>
      <span>Chargement…</span>
    </div>
  }
  <div class="actions">
    <button
      (click)="submit()"
      icon="pi pi-save"
      label="Créer"
      pButton
      type="button">
    </button>
  </div>
</p-card>
