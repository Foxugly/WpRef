<div class="container">
  <div class="container__card">
    <div class="card__brand">
      <img src="assets/logo.svg" alt="Logo" class="brand__logo">
      <h1 class="brand__title">WpRef</h1>
      <p class="brand__subtitle">Réinitialiser mon mot de passe</p>
    </div>
    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="card__form">

      <div class="field">
        <label for="old_password">Mot de passe actuel</label>
        <input
          id="old_password"
          type="password"
          formControlName="old_password"
          autocomplete="current-password"
          autofocus
        />
        @if (submitted && f['old_password'].invalid) {
          <div class="error">
            @if (f['old_password'].errors?.['required']) {
              <div>
                Le mot de passe actuel est obligatoire.
              </div>
            }
          </div>
        }
      </div>

      <div class="field">
      <label for="new_password">Nouveau mot de passe</label>
      <input
        id="new_password"
        type="password"
        formControlName="new_password"
        autocomplete="new-password"
      />
      @if (submitted && f['new_password'].invalid){
      <div class="error">
        @if (f['new_password'].errors?.['required']){
        <div>
          Le nouveau mot de passe est obligatoire.
        </div>
        }
        @if(f['new_password'].errors?.['minlength']){
        <div>
          Le nouveau mot de passe doit contenir au moins 8 caractères.
        </div>
        }
      </div>
        }
    </div>

    <!-- Confirmation -->
    <div class="field">
      <label for="confirm_new_password">Confirmer le nouveau mot de passe</label>
      <input
        id="confirm_new_password"
        type="password"
        formControlName="confirm_new_password"
        autocomplete="new-password"
      />
      @if(submitted && f['confirm_new_password'].invalid){
      <div class="error">
        @if(f['confirm_new_password'].errors?.['required']){
        <div>
          La confirmation est obligatoire.
        </div>
        }
        @if(f['confirm_new_password'].errors?.['passwordMismatch']){
        <div>
          Les mots de passe ne correspondent pas.
        </div>
        }
      </div>
        }
    </div>


      <button class="btn btn--primary" type="submit" [disabled]="isSubmitting || form.invalid">
        {{ isSubmitting ? 'Envoi en cours…' : 'Changer le mot de passe' }}
      </button>
    </form>

    <div class="card__footer">
      @if (successMessage) {
        <p class="success">{{ successMessage }}</p>
      }
      @if (errorMessage) {
        <p class="error">{{ errorMessage }}</p>
      }
    </div>
  </div>
</div>
