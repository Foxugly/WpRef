<div class="container">
  <div class="container__card">
    <div class="card__brand">
      <img alt="Logo" class="brand__logo" src="assets/logo.svg">
      <h1 class="brand__title">WpRef</h1>
      <p class="brand__subtitle">Réinitialiser mon mot de passe</p>
    </div>
    <form (ngSubmit)="onSubmit()" [formGroup]="form" class="card__form">

      <div class="field">
        <label for="old_password">Mot de passe actuel</label>
        <p-password [feedback]="false" [toggleMask]="true" autocomplete="current-password" autofocus
                    fluid formControlName="old_password" id="old_password" placeholder="******"/>
        @if (submitted && f['old_password'].invalid) {
          <div class="error">
            @if (f['old_password'].errors?.['required']) {
              <div>
                Le mot de passe actuel est obligatoire.
              </div>
            }
          </div>
        }
      </div>

      <div class="field">
        <label for="new_password">Nouveau mot de passe</label>
        <p-password [feedback]="false" [toggleMask]="true" autocomplete="new-password" fluid
                    formControlName="new_password" id="new_password" placeholder="******"/>
        @if (submitted && f['new_password'].invalid) {
          <div class="error">
            @if (f['new_password'].errors?.['required']) {
              <div>
                Le nouveau mot de passe est obligatoire.
              </div>
            }
            @if (f['new_password'].errors?.['minlength']) {
              <div>
                Le nouveau mot de passe doit contenir au moins 8 caractères.
              </div>
            }
          </div>
        }
      </div>

      <!-- Confirmation -->
      <div class="field">
        <label for="confirm_new_password">Confirmer le nouveau mot de passe</label>
        <p-password [feedback]="false" [toggleMask]="true" autocomplete="new-password"
                    fluid
                    formControlName="confirm_new_password" id="confirm_new_password" placeholder="******"/>

        @if (submitted && f['confirm_new_password'].invalid) {
          <div class="error">
            @if (f['confirm_new_password'].errors?.['required']) {
              <div>
                La confirmation est obligatoire.
              </div>
            }
            @if (f['confirm_new_password'].errors?.['passwordMismatch']) {
              <div>
                Les mots de passe ne correspondent pas.
              </div>
            }
          </div>
        }
      </div>


      <button [disabled]="isSubmitting || form.invalid" class="btn btn--primary" type="submit">
        {{ isSubmitting ? 'Envoi en cours…' : 'Changer le mot de passe' }}
      </button>
    </form>

    <div class="card__footer">
      @if (successMessage) {
        <p class="success">{{ successMessage }}</p>
      }
      @if (errorMessage) {
        <p class="error">{{ errorMessage }}</p>
      }
    </div>
  </div>
</div>
